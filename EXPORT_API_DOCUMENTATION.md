# Enterprise E-Commerce Platform - Export API Documentation

## Overview

The Export API provides comprehensive data export capabilities in multiple formats (PDF, CSV, Excel) for all major modules. All export endpoints require admin authentication.

## Base URL

```
Production: https://telogica.onrender.com/api/export
Development: http://localhost:5000/api/export
```

## Authentication

All export endpoints require:
- Bearer token authentication
- Admin role

```
Authorization: Bearer <your-admin-token>
```

## Rate Limiting

Export endpoints are rate-limited to:
- **10 requests per 5 minutes** per IP address

## Export Formats

All endpoints support three export formats via query parameter:

| Format | Query Parameter | File Extension | Content-Type |
|--------|----------------|----------------|--------------|
| PDF | `?format=pdf` | `.pdf` | `application/pdf` |
| CSV | `?format=csv` | `.csv` | `text/csv` |
| Excel | `?format=excel` | `.xlsx` | `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet` |

## Common Query Parameters

| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `format` | string | Export format (pdf/csv/excel) | `?format=pdf` |
| `filters.*` | various | Module-specific filters | See individual endpoints |

---

## Endpoints

### 1. Export Products

Export product catalog with filtering support.

**Endpoint:** `GET /api/export/products`

**Query Parameters:**
```
?format=pdf                    # Export format
&filters[category]=Electronics  # Filter by category
&filters[minPrice]=1000         # Minimum price
&filters[maxPrice]=50000        # Maximum price
```

**Response:**
- Downloads file with name: `products-{timestamp}.{ext}`

**Exported Fields:**
- Product Name
- Category
- Price
- Retailer Price
- Online Stock
- Offline Stock
- Featured Status
- Description (CSV/Excel only)

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/products?format=pdf"
```

---

### 2. Export Orders

Export order history with comprehensive filters.

**Endpoint:** `GET /api/export/orders`

**Query Parameters:**
```
?format=csv                           # Export format
&filters[paymentStatus]=completed     # Payment status
&filters[orderStatus]=shipped         # Order status
&filters[startDate]=2024-01-01        # Start date
&filters[endDate]=2024-12-31          # End date
```

**Filter Options:**

**Payment Status:**
- `pending`
- `completed`
- `failed`

**Order Status:**
- `processing`
- `shipped`
- `delivered`
- `cancelled`

**Exported Fields:**
- Order ID
- Customer Name
- Customer Email
- Total Amount
- Payment Status
- Order Status
- Order Date

**Metadata Included:**
- Total Orders
- Total Revenue
- Generated Date
- Generated By

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/orders?format=excel&filters[paymentStatus]=completed"
```

---

### 3. Export Users

Export user database with role filtering.

**Endpoint:** `GET /api/export/users`

**Query Parameters:**
```
?format=pdf                        # Export format
&filters[role]=retailer            # Filter by role
&filters[isApproved]=true          # Filter by approval status
```

**Filter Options:**

**Role:**
- `admin`
- `retailer`
- `user`

**isApproved:**
- `true`
- `false`

**Exported Fields:**
- Name
- Email
- Phone
- Role
- Approved Status
- Address
- Registration Date

**Metadata Included:**
- Total Users
- Number of Admins
- Number of Retailers
- Number of Regular Users

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/users?format=csv&filters[role]=retailer"
```

---

### 4. Export Warranties

Export warranty registrations with status filtering.

**Endpoint:** `GET /api/export/warranties`

**Query Parameters:**
```
?format=excel                      # Export format
&filters[status]=approved          # Filter by status
&filters[startDate]=2024-01-01     # Purchase start date
&filters[endDate]=2024-12-31       # Purchase end date
```

**Filter Options:**

**Status:**
- `pending`
- `approved`
- `rejected`

**Exported Fields:**
- Product Name
- Serial Number
- Model Number
- Customer Name
- Customer Email
- Status
- Purchase Date
- Warranty Start Date
- Warranty End Date

**Metadata Included:**
- Total Warranties
- Pending Count
- Approved Count
- Rejected Count

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/warranties?format=pdf&filters[status]=approved"
```

---

### 5. Export Quotes

Export quote requests with status filtering.

**Endpoint:** `GET /api/export/quotes`

**Query Parameters:**
```
?format=csv                        # Export format
&filters[status]=accepted          # Filter by status
&filters[startDate]=2024-01-01     # Request start date
&filters[endDate]=2024-12-31       # Request end date
```

**Filter Options:**

**Status:**
- `pending`
- `responded`
- `accepted`
- `rejected`

**Exported Fields:**
- Customer Name
- Customer Email
- Customer Type (user/retailer)
- Number of Items
- Quoted Price
- Discount Percentage
- Status
- Request Date

**Metadata Included:**
- Total Quotes
- Pending Count
- Responded Count
- Accepted Count
- Rejected Count

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/quotes?format=excel&filters[status]=accepted"
```

---

### 6. Export Invoices

Export invoice records with payment filtering.

**Endpoint:** `GET /api/export/invoices`

**Query Parameters:**
```
?format=pdf                           # Export format
&filters[paymentStatus]=completed     # Filter by payment status
&filters[startDate]=2024-01-01        # Invoice start date
&filters[endDate]=2024-12-31          # Invoice end date
```

**Filter Options:**

**Payment Status:**
- `pending`
- `completed`
- `failed`

**Exported Fields:**
- Invoice Number
- Customer Name
- Customer Email
- Subtotal
- Discount
- Tax
- Total Amount
- Payment Status
- Invoice Date

**Metadata Included:**
- Total Invoices
- Paid Invoices Count
- Total Amount

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/invoices?format=csv&filters[paymentStatus]=completed"
```

---

### 7. Export Product Units

Export product unit inventory with tracking.

**Endpoint:** `GET /api/export/product-units`

**Query Parameters:**
```
?format=excel                      # Export format
&filters[status]=available         # Filter by status
&filters[stockType]=online         # Filter by stock type
&filters[productId]=123abc         # Filter by product ID
```

**Filter Options:**

**Status:**
- `available`
- `sold`
- `reserved`
- `defective`
- `returned`

**Stock Type:**
- `online`
- `offline`
- `both`

**Exported Fields:**
- Serial Number
- Product Name
- Model Number
- Status
- Stock Type
- Warranty Period (Months)
- Manufacturing Date
- Current Owner

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/product-units?format=pdf&filters[status]=available"
```

---

### 8. Export Retailer Inventory

Export retailer inventory with status tracking.

**Endpoint:** `GET /api/export/retailer-inventory`

**Query Parameters:**
```
?format=csv                        # Export format
&filters[status]=in_stock          # Filter by status
&filters[retailerId]=123abc        # Filter by retailer ID
```

**Filter Options:**

**Status:**
- `in_stock`
- `sold`
- `returned`
- `damaged`

**Exported Fields:**
- Retailer Name
- Product Name
- Serial Number
- Status
- Purchase Date
- Sold Date

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/retailer-inventory?format=excel&filters[status]=in_stock"
```

---

### 9. Export Sales Report

Generate comprehensive sales analytics report.

**Endpoint:** `GET /api/export/sales-report`

**Query Parameters:**
```
?format=pdf                        # Export format
&startDate=2024-01-01              # Report start date
&endDate=2024-12-31                # Report end date
```

**Exported Fields:**
- Order ID
- Customer Name
- Customer Type (user/retailer)
- Amount
- Quote-Based Status
- Order Date

**Metadata Included:**
- Total Orders
- Total Revenue
- Average Order Value
- Date Range
- Generated By

**Example:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://telogica.onrender.com/api/export/sales-report?format=excel&startDate=2024-01-01&endDate=2024-12-31"
```

---

## Response Formats

### Success Response

File download with appropriate headers:

```
Content-Type: application/pdf | text/csv | application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
Content-Disposition: attachment; filename="export-timestamp.ext"
```

### Error Responses

**400 Bad Request**
```json
{
  "message": "Invalid format. Use pdf, csv, or excel"
}
```

**401 Unauthorized**
```json
{
  "message": "Not authenticated"
}
```

**403 Forbidden**
```json
{
  "message": "Admin access required"
}
```

**404 Not Found**
```json
{
  "message": "No data found matching the filters"
}
```

**429 Too Many Requests**
```json
{
  "message": "Too many export requests. Please try again later.",
  "retryAfter": 300
}
```

**500 Internal Server Error**
```json
{
  "message": "Failed to export data",
  "error": "Error details"
}
```

---

## PDF Export Features

- **Professional Layout:** Enterprise-grade document design
- **Metadata Header:** Export details and statistics
- **Table Format:** Clean columnar data presentation
- **Pagination:** Automatic page breaks with page numbers
- **Footer:** Generation timestamp and page numbers
- **Custom Formatting:** Currency, dates, and status indicators

## CSV Export Features

- **Standard Format:** RFC 4180 compliant
- **Headers:** Column names in first row
- **UTF-8 Encoding:** International character support
- **Delimiter:** Comma-separated values
- **Quotes:** Automatic quoting of text fields

## Excel Export Features

- **XLSX Format:** Modern Excel format
- **Styled Headers:** Bold column headers
- **Auto-sizing:** Optimized column widths
- **Multiple Sheets:** Single sheet per export
- **Formulas:** Where applicable

---

## Frontend Integration Example

```typescript
import { saveAs } from 'file-saver';

const exportData = async (
  endpoint: string,
  format: 'pdf' | 'csv' | 'excel',
  filters = {}
) => {
  const queryParams = new URLSearchParams({ format, ...filters });
  const token = localStorage.getItem('token');
  
  const response = await fetch(
    `${API_URL}/api/export/${endpoint}?${queryParams}`,
    {
      headers: { Authorization: `Bearer ${token}` },
    }
  );
  
  if (!response.ok) throw new Error('Export failed');
  
  const blob = await response.blob();
  const extension = format === 'excel' ? 'xlsx' : format;
  saveAs(blob, `${endpoint}-${Date.now()}.${extension}`);
};

// Usage
await exportData('products', 'pdf', { category: 'Electronics' });
await exportData('orders', 'excel', { paymentStatus: 'completed' });
```

---

## Best Practices

1. **Use Filters:** Apply filters to reduce export size and improve performance
2. **Choose Format:** Select appropriate format based on use case:
   - PDF: Professional reports and presentations
   - CSV: Data analysis and spreadsheet import
   - Excel: Advanced spreadsheet features
3. **Respect Rate Limits:** Implement retry logic with exponential backoff
4. **Error Handling:** Handle all error responses gracefully
5. **Progress Indication:** Show loading state during export operations

---

## Security Notes

- All endpoints require admin authentication
- Rate limiting prevents abuse
- Input validation on all filters
- MongoDB injection protection
- XSS protection on output

---

## Support

For issues or questions:
- Check error messages for specific details
- Verify authentication token validity
- Ensure admin role is assigned
- Review rate limit status
- Contact support with request ID from logs
